<div class="box-content" data-lift="surround?with=user;at=content">
	<head_merge> <script type="text/javascript" src="/js/jquery.ui.widget.min.js"></script> <script type="text/javascript" src="/js/jquery.iframe-transport.js"></script> <script type="text/javascript" src="/js/jquery.fileupload.js"></script>
	<link rel="stylesheet" href="/css/jquery.fileupload-ui.css" type="text/css" />
	<link rel="stylesheet" href="/css/bootstrap-modal.css" type="text/css" />
	<link rel="stylesheet" href="/css/datetimepicker.css" />
	<link rel="stylesheet" href="/css/jquery.Jcrop.css" type="text/css" />
	</head_merge>

	<script type="text/javascript" src="/js/jquery.Jcrop.js"></script>
	<div id="opt_brand_tip" class="alert hide"></div>
	<form data-lift="form.ajax?class=form-horizontal">
		<fieldset data-lift="user.BrandOps.add">
			<div id="group_regNo" class="control-group">
				<label for="regNo" class="control-label">商标注册号</label>
				<div class="controls">
					<div class="input-append">
						<input type="text" id="regNo" name="regNo" placeholder="输入商标注册号" required class="input-medium">
						<button class="btn" type="button" id="getRemoteData" name="getRemoteData" data-lift="user.BrandOps.getRemoteData">从标局获取数据</button>
					</div>
					<span id="error_regNo" class="help-inline"></span> <input type="hidden" id="pic" name="pic" />
					<button class="btn btn-success" type="button" data-toggle="modal" data-target="#uploadDialog">商标图片上传</button>
				</div>
			</div>
			<div id="group_brand_type" class="control-group">
				<label for="brand_type" class="control-label">商标类别</label>
				<div class="controls">
					<input type="hidden" id="brand_type" name="brand_type" required> <span id="error_brand_type" class="help-inline"></span>
				</div>
			</div>
			<div id="group_basePrice" class="control-group">
				<label for="basePrice" class="control-label">出售底价</label>
				<div class="controls">
					<div class="input-prepend input-append">
						<span class="add-on">￥</span> <input type="text" id="basePrice" name="basePrice" class="input-small" required> <span class="add-on">元</span>
					</div>
					<span id="error_basePrice" class="help-inline"></span>
				</div>
			</div>
			<div id="group_name" class="control-group">
				<label for="name" class="control-label">商标名称</label>
				<div class="controls">
					<input type="text" id="name" name="name" required> <span id="error_name" class="help-inline"></span>
				</div>
			</div>
			<div id="group_regDate" class="control-group">
				<label for="regDate" class="control-label">注册日期</label>
				<div class="controls">
					<div class="input-append date" id="date-regDate" data-date="2012-12-22" data-date-format="yyyy-mm-dd">
						<input type="text" class="span2" id="regDate" name="regDate" readonly> <span class="add-on"><i class="icon-remove"></i></span> <span class="add-on"><i class="icon-th"></i></span>
					</div>
					<span id="error_regDate" class="help-inline"></span>
				</div>
			</div>
			<div id="group_applicant" class="control-group">
				<label for="applicant" class="control-label">申请人</label>
				<div class="controls">
					<input type="text" id="applicant" name="applicant" placeholder="填写商标申请人" required> <span id="error_applicant" class="help-inline"></span>
				</div>
			</div>
			<div id="group_useDescn" class="control-group">
				<label for="useDescn" class="control-label">使用范围</label>
				<div class="controls">
					<textarea rows="3" id="useDescn" name="useDescn" class="span6"></textarea>
					<span id="error_useDescn" class="help-inline"></span>
				</div>
			</div>
			<div id="group_descn" class="control-group">
				<label for="descn" class="control-label">商标说明</label>
				<div class="controls">
					<textarea rows="3" id="descn" name="descn" class="span6"></textarea>
					<span id="error_descn" class="help-inline"></span>
				</div>
			</div>
			<div class="form-actions">
				<button class="btn btn-primary" type="submit">确认发布</button>
				<input type="hidden" name="sub">
			</div>
		</fieldset>
	</form>

	<div id="uploadDialog" class="modal hide fade" tabindex="-1" data-width="780">
		<div class="modal-header">
			<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
			<h3 id="loginModalLabel">商标图片上传</h3>
		</div>
		<div class="modal-body">
			<div class="row-fluid">
				<form id="file-upload" action="/uploading" method="POST" enctype="multipart/form-data">
					<span class="btn btn-success fileinput-button"> <i class="icon-plus icon-white"></i> <span>商标图片上传...</span> <input id="fileupload" type="file" name="files[]" multiple>
					</span>
				</form>
				<div style="margin-top: 10px">
					<table cellpadding="0" cellspacing="0" border="0">
						<tr>
							<td><img id="original-img" src="/upload/tmp/ECS2T0HTASYNGNC2.jpg" /></td>
							<td>
								<div id="preview-image-box" style="width: 320px; height: 200px; overflow: hidden; margin-left: 5px;">
									<img id="preview-img" width="400" height="267" style="border:1px solid red"/>
								</div>
							</td>
						</tr>
					</table>
				</div>
			</div>
		</div>
		<div class="modal-footer">
			<form data-lift="form.ajax">
				<div data-lift="user.BrandOps.uploadBrandPic">
					<input type="hidden" id="picName" name="picName" /> <input type="hidden" id="x" name="x" /> <input type="hidden" id="y" name="y" /> <input type="hidden" id="w" name="w" /> <input type="hidden" id="h" name="h" />
					<button type="submit" id="submit-avatar" class="btn btn-primary">保存商标图</button>
				</div>
			</form>

		</div>
	</div>

	<script type="text/javascript" src="/js/bootstrap-datetimepicker.min.js"></script>
	<script type="text/javascript" src="/js/locales/bootstrap-datetimepicker.zh-CN.js"></script>
	<script type="text/javascript" src="/js/bootstrap-modalmanager.js"></script>
	<script type="text/javascript" src="/js/bootstrap-modal.js"></script>
	<script type="text/javascript">
		$(function() {
			$('#date-regDate').datetimepicker({
				language : 'zh-CN',
				weekStart : 1,
				todayBtn : 1,
				autoclose : 1,
				minView : 2,
				todayHighlight : 1
			});

			$('#getRemoteData').click(function() {
				$('#getRemoteData').addClass("disabled");
			});

			$("#file-upload").fileupload({
				dataType : 'json',
				url : '/uploading',
				dropZone : $('#original-img'),
				done : function(e, data) {
					$("#original-img").attr("src","/upload/tmp/" + data.result.name);
					$("#preview-img").attr("src","/upload/tmp/" + data.result.name);
					$("#picName").val(data.result.name);
					$("#pic").val(data.result.name);
					
					$("#original-img").Jcrop({
						onChange : showPreview,
						onSelect : showPreview,
						aspectRatio : 320 / 200,
						minSize:[160,100],
						setSelect : [ 0, 0, 320, 200 ]
					});
					
					function showPreview(c) {
						if (parseInt(c.w) > 0) {
							var rx = 320 / c.w;
							var ry = 200 / c.h;
							
							var w = $("#original-img").width();
							var h = $("#original-img").height();

							$("#preview-img").css({
								width : Math.round(rx * w) + 'px',
								height : Math.round(ry * h) + 'px',
								marginLeft : '-' + Math.round(rx * c.x) + 'px',
								marginTop : '-' + Math.round(ry * c.y) + 'px'
							});
							$('#x').val(c.x);
							$('#y').val(c.y);
							$('#w').val(c.w);
							$('#h').val(c.h);
						}
					}
				}
			});
			
		});

		
	</script>
</div>